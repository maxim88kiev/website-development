!function(b){var o=document,r=window;b.fn.MyDtime=function(s){s=b.extend({times:!1,button:!0,step:1,select:!0,setDate:"",language:"ru",readonly:!0},s);return this.each(function(){var e=b(this);e.addClass("addDtime");var t=new Date,n=s.times,a=s.button,i=s.step,m=0==s.select?"disabled":"",g=""!=s.setDate?s.setDate:"",y=s.language,d=s.readonly;function l(t){return b(r).width()-b(t).offset().left<b(t).width()&&b(t).position().left-(parseInt(b(t).width()-(b(r).width()-b(t).offset().left))+e.height())}function I(t,e,n,a,i,d,l,s){if("ru"==s)var o={0:"январь",1:"февраль",2:"март",3:"апрель",4:"май",5:"июнь",6:"июль",7:"август",8:"сентябрь",9:"октябрь",10:"ноябрь",11:"декабрь"},r={h:"Часы",i:"Минуты"};else if("ua"==s)o={0:"січень",1:"лютий",2:"березень",3:"квітень",4:"травень",5:"червень",6:"липень",7:"серпень",8:"вересень",9:"жовтень",10:"листопад",11:"грудень"},r={h:"Години",i:"Хвилини"};var c,v,f,_,h,u,x,p,m,g,y;""==b.trim(t.val())&&""==l||"0000-00-00 00:00:00"==b.trim(t.val())?(_=e.getFullYear(),h=e.getMonth(),u=e.getDate(),1==n&&(p=e.getHours(),m=e.getMinutes())):(_=(v=(c=""!=l?b.trim(l).split(" "):b.trim(t.val()).split(" "))[0].split("."))[2],h=parseInt(v[1].replace(/^0+/,""))-1,u=parseInt(v[0].replace(/^0+/,"")),1==n&&(f=c[1].split(":"),p=parseInt(f[0].replace(/^0+/,"")),m=parseInt(f[1].replace(/^0+/,"")))),x=new Date(_,h+1,0).getDate(),mas_d={1:"Пн",2:"Вт",3:"Ср",4:"Чт",5:"Пт",6:"Сб",0:"Вс"},n_day=new Date(_,h,1).getDay()-1,-1==n_day&&(n_day=6),y="<div class='d_con_ym'>",y+="<div class='g_back'></div>",y+="<div class='d_month-not-sel'>"+o[h]+"</div>",y+="<div class='d_year-not-sel'>"+_+"</div>",y+="<select class='d_year' "+d+">";for(var I=e.getFullYear()-5;I<e.getFullYear()+25;I++)y+=_==I?"<option class='o_year' value='"+I+"' selected>"+I+"</option>":"<option class='o_year' value='"+I+"'>"+I+"</option>";for(var I in y+="</select>",y+="<select class='d_month' "+d+">",o)o[I]==o[h]?y+="<option class='o_month' value='"+I+"' selected>"+o[I]+"</option>":y+="<option class='o_month' value='"+I+"'>"+o[I]+"</option>";for(var I in y+="</select>",y+="<div class='g_next'></div>",y+="</div>",y+="<table class='cont_ch'>",y+="<tr>",mas_d)0<I&&(y+="<th>"+mas_d[I]+"</th>"),6==I&&(y+="<th>"+mas_d[0]+"</th>");y+="</tr>";for(I=1;I<=x+n_day;I++)1==I&&(y+="<tr>"),I>n_day?I%7-6==0||I%7==0?y+="<td><div class='no_chd'>"+(I-n_day)+"</div></td>":_==e.getFullYear()&&h==e.getMonth()&&I-n_day==e.getDate()?y+="<td><div class='chd n_chd'>"+(I-n_day)+"</div></td>":I-n_day==u&&I!=e.getDate()?y+="<td><div class='chd s_chd'>"+(I-n_day)+"</div></td>":y+="<td><div class='chd'>"+(I-n_day)+"</div></td>":y+="<td></td>",I%7==0&&(y+="</tr><tr>");if(y+="</tr>",y+="</table>",1==n){y+="<div class='dt_time'>",y+="<div class='cn_time'>"+r.h+"<br>",y+="<select class='d_hour'>";for(I=0;I<=23;I++)g=(I<10?"0":"")+I,y+=I==p?"<option class='o_hour' value='"+g+"' selected>"+g+"</option>":"<option class='o_hour' value='"+g+"'>"+g+"</option>";y+="</select>",y+="</div>",y+="<div class='rz_time'>:</div>",y+="<div class='cnn_time'>"+r.i+"<br>",y+="<select class='d_minute'>";for(I=0;I<60;I+=i)g=(I<10?"0":"")+I,y+=I==m?"<option class='o_minute' value='"+g+"' selected>"+g+"</option>":"<option class='o_minute' value='"+g+"'>"+g+"</option>";y+="</select>",y+="</div><br>",y+="</div>"}return 1==a&&(y+="<div class='dt_button'>",y+="<div class='c_button'>✖</div>",y+="</div>"),y}function D(){b(".dtime").hide(),b(".addDtime").removeClass("dtime-active")}e.is("input")&&1==d&&e.attr("readonly",!0),e.after('<div class="dtime"></div>'),e.next().on("selectstart",function(){return!1}),e.next().html(I(e,t,n,a,i,m,g,y)),function t(e,n,a,i,d){if(1==a){var l="",s="";e.next().find(".d_hour").on("change",function(){l=" "+b(this).val()+":"+e.next().find(".d_minute").val(),""==b.trim(e.val())?e.val(e.next().find(".n_chd").text()+"."+(parseInt(e.next().find(".d_month").val())+1<10?"0":"")+(parseInt(e.next().find(".d_month").val())+1)+"."+(e.next().find(".n_chd").text()<10?"0":"")+e.next().find(".d_year").val()+l):e.val(e.val().replace(/[0-9]{2}\:/i,b(this).val()+":"))}),e.next().find(".d_minute").on("change",function(){s=" "+e.next().find(".d_hour").val()+":"+b(this).val(),""==b.trim(e.val())?e.val((e.next().find(".n_chd").text()<10?"0":"")+e.next().find(".n_chd").text()+"."+(parseInt(e.next().find(".d_month").val())+1<10?"0":"")+(parseInt(e.next().find(".d_month").val())+1)+"."+e.next().find(".d_year").val()+s):e.val(e.val().replace(/\:[0-9]{2}/i,":"+b(this).val()))})}if(1==i){var o,r="";e.next().find(".c_button").on("click",function(){return e.next().hide(),!1}),e.next().find(".t_button").on("click",function(){return n=new Date,o=15==d?0:n.getMinutes(),1==a&&(r=" "+(n.getHours()<10?"0":"")+n.getHours()+":"+(o<10?"0":"")+o),e.val((n.getDate()<10?"0":"")+n.getDate()+"."+(parseInt(n.getMonth())+1<10?"0":"")+(parseInt(n.getMonth())+1)+"."+n.getFullYear()+r),e.next().html(I(e,n,a,i,d,m,g,y)),t(e,n,a,i,d),!1})}var c="";e.next().find(".chd").on("click",function(){1==a&&(c=" "+e.next().find(".d_hour").val()+":"+e.next().find(".d_minute").val()),e.next().find(".cont_ch").find(".s_chd").removeClass("s_chd"),b(this).addClass("s_chd"),e.is("input")&&e.val((b(this).text()<10?"0":"")+b(this).text()+"."+(parseInt(e.next().find(".d_month").val())+1<10?"0":"")+(parseInt(e.next().find(".d_month").val())+1)+"."+e.next().find(".d_year").val()+c),D()});var v="",f="",_="";e.next().find(".d_year").on("change",function(){return""==(_=e.next().find(".n_chd").text())&&(_=1),1==a&&(v=" "+e.next().find(".d_hour").val()+":"+e.next().find(".d_minute").val()),""==b.trim(e.val())?e.val((_<10?"0":"")+_+"."+(parseInt(e.next().find(".d_month").val())+1<10?"0":"")+(parseInt(e.next().find(".d_month").val())+1)+"."+b(this).val()+v):e.val(e.val().replace(/\.[0-9]{4}/i,"."+b(this).val())),e.next().html(I(e,n,a,i,d,m,g,y)),t(e,n,a,i,d),!1}),e.next().find(".d_month").on("change",function(){return""==(_=e.next().find(".n_chd").text())&&(_=1),1==a&&(f=" "+e.next().find(".d_hour").val()+":"+e.next().find(".d_minute").val()),""==b.trim(e.val())?e.val((_<10?"0":"")+_+"."+(parseInt(b(this).val())+1<10?"0":"")+(parseInt(b(this).val())+1)+"."+e.next().find(".d_year").val()+f):e.val(e.val().replace(/\.[0-9]{2}\./i,"."+(parseInt(b(this).val())+1<10?"0":"")+(parseInt(b(this).val())+1)+".")),e.next().html(I(e,n,a,i,d,m,g,y)),t(e,n,a,i,d),!1});var h,u,x="",p="";e.next().find(".g_next").on("click",function(){return h=parseInt(e.next().find(".d_month").val())+2,(u=parseInt(e.next().find(".d_year").val()))==e.next().find(".o_year:last").val()&&12<h?(u=e.next().find(".o_year:first").val(),h=1,e.next().find(".o_year[value="+u+"]").prop("selected",!0)):12<h&&(h=1,e.next().find(".o_year[value="+(u+1)+"]").prop("selected",!0)),1==a&&(x=" "+e.next().find(".d_hour").val()+":"+e.next().find(".d_minute").val()),""==b.trim(e.val())?e.val((e.next().find(".n_chd").text()<10?"0":"")+e.next().find(".n_chd").text()+"."+(h<10?"0":"")+h+"."+u+x):e.val(e.val().replace(/\.[0-9]{2}\./i,"."+(h<10?"0":"")+h+".")),e.next().find(".d_year").change(),!1}),e.next().find(".g_back").on("click",function(){return h=parseInt(e.next().find(".d_month").val())+1-1,(u=parseInt(e.next().find(".d_year").val()))==e.next().find(".o_year:first").val()&&h<1?(u=e.next().find(".o_year:last").val(),h=12,e.next().find(".o_year[value="+u+"]").prop("selected",!0)):h<1&&(h=12,e.next().find(".o_year[value="+(u-1)+"]").prop("selected",!0)),1==a&&(p=" "+e.next().find(".d_hour").val()+":"+e.next().find(".d_minute").val()),""==b.trim(e.val())?e.val((e.next().find(".n_chd").text()<10?"0":"")+e.next().find(".n_chd").text()+"."+(h<10?"0":"")+h+"."+u+p):e.val(e.val().replace(/\.[0-9]{2}\./i,"."+(h<10?"0":"")+h+".")),e.next().find(".d_year").change(),!1})}(e,t,n,a,i),b(o).on("click",function(t){b(t.target).closest(".addDtime").length||b(t.target).closest(".dtime").length||b(t.target).closest(".g_back").length||b(t.target).closest(".g_next").length||b(t.target).closest(".t_button").length||e.is("input")&&D()}),e.on("focus click",function(){b(this).is("input")&&D(),e.next().show().css({left:e.position().left,top:e.position().top+e.height()}),0!=l(".dtime")&&b(".dtime").css({left:l(".dtime")}),e.addClass("dtime-active")}).on("keyup",function(t){switch(t.keyCode){case 27:b(this).is("input")&&D()}}),e.is("div")&&e.next().css({position:"relative",float:"left"}).show()})}}(jQuery);